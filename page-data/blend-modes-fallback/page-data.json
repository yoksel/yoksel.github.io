{"componentChunkName":"component---src-templates-blog-post-js","path":"/blend-modes-fallback","result":{"data":{"markdownRemark":{"html":"<p>Не так давно в <a href=\"https://developer.mozilla.org/en-US/Firefox/Releases/32\">Firefox 32</a> включили поддержку <code>mix-blend-mode</code>, a в <a href=\"http://www.chromestatus.com/features/5163890719588352\">Chrome 37</a> — <a href=\"http://dev.w3.org/csswg/css-shapes/\">CSS shapes</a>, то есть возможность управлять формой, по которой текст будет обтекать элемент. Обе технологии выглядят очень интересно, так что я решила попробовать их в действии, заодно выяснив как будет выглядеть страница в браузерах, где они не поддерживаются.</p>\n<!--more-->\n<p>В процессе написания статьи Safari обновился до версии 7.1, и в нем тоже появилась поддержка режимов наложения. Таким образом, режим наложения слоев фона имеет уже <a href=\"http://caniuse.com/#feat=css-backgroundblendmode\">довольно неплохую поддержку браузерами</a>, с наложением друг на друга элементов страницы дела пока обстоят <a href=\"http://caniuse.com/#feat=css-mixblendmode\">похуже</a>, но я уверена, что у них всё впереди.\nТакже в Safari 7.1 стали доступны CSS shapes, хотя и с префиксом <code>-webkit-</code>.</p>\n<p>По обеим темам уже были хорошие статьи на английском языке, например:</p>\n<ul>\n  <li><a href=\"http://alistapart.com/article/css-shapes-101\">CSS Shapes 101</a></li>\n  <li><a href=\"http://alistapart.com/blog/post/moving-forward-with-css-shapes\">Moving Forward with CSS Shapes</a></li>\n  <li><a href=\"http://www.html5rocks.com/en/tutorials/shapes/getting-started/\">Getting Started with CSS Shapes</a></li>\n  <li><a href=\"https://dev.opera.com/articles/getting-to-know-css-blend-modes/\">Getting to Know CSS Blend Modes</a></li>\n</ul>\n<p>Для более глубокого изучения есть спецификации:</p>\n<ul>\n  <li><a href=\"http://dev.w3.org/fxtf/compositing-1/\">Compositing and Blending Level 1</a></li>\n  <li><a href=\"http://dev.w3.org/csswg/css-shapes/\">CSS Shapes Module Level 1</a></li>\n</ul>\n<p>Сейчас я не буду подробно рассматривать обе технологии (потому что это отдельные большие темы), а расскажу только про небольшой эксперимент и про то, что можно сделать для изящной деградации в старых браузерах.</p>\n<p>Для начала я открыла новый Хром и сделала такое:</p>\n<iframe height=\"500\"\n      style=\"width: 100%\"\n      title=\"no title\"\n      src=\"http://codepen.io/yoksel/embed/KCibG/?&default-tab=result\"\n    ></iframe>\n<p><a href=\"http://codepen.io/yoksel/full/KCibG/\">Посмотреть в полный рост</a>.</p>\n<p>В демо используются <code>mix-blend-mode</code> и <code>shape-outside</code>. Режим наложения <code>mix-blend-mode: multiply;</code> задан всему контейнеру с текстом и картинками, а <code>shape-outside</code> для каждой картинки свой.</p>\n<p>Полноценно оно отображается только в Safari 7.1, он умеет и режимы смешивания, и CSS shapes, но формы пока работают с префиксом <code>-webkit-</code>.</p>\n<p>Также оно будет работать в последних Хроме/Опере со включенными экспериментальными возможностями (они умеют CSS shapes, но <code>mix-blend-mode</code> пока что за флагом, и их надо включать отдельно).</p>\n<p>Включить в Хроме:\n<code>chrome://flags/#enable-experimental-web-platform-features</code></p>\n<p>В Опере:\n<code>opera://flags/#enable-experimental-web-platform-features</code></p>\n<p>В Safari и Chrome/Opera с флагами демо выглядит вот так:</p>\n<img src=\"http://img-fotki.yandex.ru/get/4805/5091629.a1/0_855c2_8fe321a9_M.jpg\"/>\n<p> Чтобы увидеть неработающие формы, достаточно открыть демо в Firefox:</p>\n<img src=\"http://img-fotki.yandex.ru/get/6836/5091629.a1/0_855c4_79b5ff4_M.jpg\"/>\n<p> а неработающие режимы смешивания — Internet Explorer:</p>\n<img src=\"http://img-fotki.yandex.ru/get/4803/5091629.a1/0_855c3_f9ded859_M.jpg\"/>\n<p>Если нужно, чтобы формы работали везде, можно воспользоваться полифилом: <a href=\"https://github.com/adobe-webplatform/css-shapes-polyfill\">css-shapes-polyfill</a>, но следует иметь в виду, что это может создать дополнительную нагрузку для браузера. При этом в браузерах без поддержки CSS-форм ничего особо не ломается — картинки просто обтекаются текстом не по кривой, а по прямоугольному контуру.</p>\n<p>Firefox можно оставить как есть, но с IE надо что-то делать: белый фон у картинок и белый в тенях заголовка выглядят не очень. Самый простой вариант — добавить блоку с текстом белую подложку:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.l-wrapper</span> <span class=\"token punctuation\">{</span>\n  ...\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 40px 70px<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* добавляем отступы */</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> #FFF<span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* добавляем фон */</span>\n  ...\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Очень хотелось воспользоваться <code>@supports</code>, чтобы убрать отступы в браузерах с поддержкой режимов наложения, но <code>@supports</code> <a href=\"http://caniuse.com/#feat=css-featurequeries\">не работает в Сафари</a>.</p>\n<p>Тогда мне пришло в голову, что можно сделать белые поля не создавая отступы, например, так:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.l-wrapper</span> <span class=\"token punctuation\">{</span>\n  ...\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> #FFF<span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* добавляем фон */</span>\n  <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span> 0 0 0 60px #FFF <span class=\"token comment\">/* добавляем поля */</span>\n  ...\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Результат: <a href=\"http://codepen.io/yoksel/full/AJKEh/\">codepen.io/yoksel/full/AJKEh/</a></p>\n<p>В браузерах с поддержкой режимов наложения ничего не изменилось, а в IE появился белый фон:</p>\n<img src=\"http://img-fotki.yandex.ru/get/4800/5091629.a1/0_855cb_3998ac74_M.jpg\"/>\n<p>В продвинутых браузерах фона под текстом не будет, потому что при режиме смешивания <code>multiply</code> белый цвет исчезает.</p>\n<p>Мне нравится способ с фоном, но сейчас получается, что демо в разных браузерах может выглядеть по-разному, и можно попробовать сделать лучше, например, с помощью SVG.</p>\n<p>В SVG-фильтрах есть режимы смешивания. Их меньше, чем в CSS, но среди них есть нужный нам <code>multiply</code>.</p>\n<p>Создаем фильтр:</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>svg-defs<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filter</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>multiply<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">x</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- задаем картинку фона для фильтра --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>feImage</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>bgimage<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">result</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>bgimage<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">x</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>206<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xlink:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://img-fotki.yandex.ru/get/6846/5091629.a1/0_8558d_406830d_M<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>feImage</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- задаем повторение фона --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>feTile</span> <span class=\"token attr-name\">in</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>bgimage<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>feTile</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- накладываем картинку, к которой применен фильтр,\n    на предыдущий фон с режимом multiply --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>feBlend</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>multiply<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">in2</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>SourceGraphic<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filter</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><i>Было бы куда удобнее задавать режим наложения исходной картинки на нижележащие слои страницы, а не на картинку, заданную в фильтре (здесь это <code>feImage</code>). Для этого в SVG предусмотрена возможность в качестве одного из источников фильтра задавать <code>BackgroundImage</code> — по смыслу это снимок экрана под областью действия фильтра. <code>BackgroundImage</code> позволил бы сделать фильтр гораздо короче:</i></p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>svg-defs<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filter</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>multiply<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">x</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>feBlend</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>multiply<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">in2</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>BackgroundImage<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">in</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>SourceGraphic<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filter</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><i>К сожалению, на момент написания статьи <code>BackgroundImage</code> в фильтрах не работает.</i></p>\n<p>Чтобы фильтры работали везде, картинки, к которым они применяются, тоже надо завернуть в SVG. Примерный код:</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>pic pic--dragon<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">viewBox</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>0 0 300 161<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image</span> <span class=\"token attr-name\"><span class=\"token namespace\">xlink:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://img-fotki.yandex.ru/get/6840/5091629.a1/0_855a9_b872dbe5_M<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>100%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>100%<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">filter</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>url(#multiply)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Для SVG-элементов обязательно надо задавать размеры, можно с помощью CSS.</p>\n<p>В тенях заголовка остался белый цвет. В случае с относительно однородным фоном (как в этом примере) можно заменить белый на более подходящий оттенок, с пестрым это не сработает, и придется придумывать что-то ещё.</p>\n<p>Результат:</p>\n<iframe height=\"500\"\n      style=\"width: 100%\"\n      title=\"no title\"\n      src=\"http://codepen.io/yoksel/embed/wavqm/?&default-tab=result\"\n    ></iframe>\n<p>SVG-фильтры для SVG элементов работают во всех современных браузерах, в IE начиная  с <nobr>10-й</nobr> версии. Фильтры были бы отличным решением, если бы не некоторые нюансы:</p>\n<ol>\n<li>Некоторые браузеры вообще не понимают SVG (IE8 и старше, например). Для них SVG-элементам нужно будет задать  фоном растровые изображения.</li>\n<li>SVG-фильтры <a href=\"http://caniuse.com/#feat=svg-filters\">не работают в IE9</a>. Его нужно будет как-то определить, чтобы задавать белую подложку для него и для более старых версий IE.</li>\n<li>При использовании фильтров фон под картинкой ресайзится вместе с картинкой. То есть картинка приклеивается к фону с применением заданного режима наложения, и дальнейшие манипуляции делаются уже с этой новой склейкой.</li>\n<li>При значительном изменении размеров картинки с фильтром между \"плитками\" фона могут появляться однопиксельные полосы.</li>\n</ol>\n<p>Пример для проблем №3 и №4 (порастягивайте окно браузера):</p>\n<iframe height=\"500\"\n      style=\"width: 100%\"\n      title=\"no title\"\n      src=\"http://codepen.io/yoksel/embed/gocDK/?&default-tab=result\"\n    ></iframe>\n<p>На фонах с четким рисунком несовпадение и \"размыливание\" фона будет очень заметно.</p>\n<p>Если исходное изображение имеет белые поля, можно попробовать использовать SVG-маску. Для этого делается копия картинки, где белые поля сделаны прозрачными или залиты черным, а часть картинки, которая должна быть показана — полностью белая. Картинка для рыцаря выглядит вот так:</p>\n<img src=\"http://img-fotki.yandex.ru/get/4509/5091629.a2/0_85a64_94d6d625_M\">\n<p>Код маски:</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mask</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>mask<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image</span> <span class=\"token attr-name\"><span class=\"token namespace\">xlink:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://img-fotki.yandex.ru/get/4509/5091629.a2/0_85a64_94d6d625_M<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>203<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mask</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Результат применения:</p>\n<iframe height=\"500\"\n      style=\"width: 100%\"\n      title=\"no title\"\n      src=\"http://codepen.io/yoksel/embed/AblID/?&default-tab=result\"\n    ></iframe>\n<p>Приклееный фон остался только под рыцарем, пространство вокруг фигуры полностью прозрачное, и под ним виден фон страницы. Допускаю, что для некоторых фонов способ с маской вполне подойдет.</p>\n<p>Способ с маской и фильтрами позволяет получить режимы смешивания в IE10+ и может сработать, если нужный режим наложения есть в SVG. Правда, этот способ отличают довольно громоздкие конструкции. Я бы предпочла вариант на чистом CSS, но не исключено, что способ с SVG окажется в каких-то ситуациях более подходящим.</p>","frontmatter":{"title":"Режимы наложения и их фоллбеки","desc":"Не так давно в Firefox 32 включили поддержку mix-blend-mode, a в Chrome 37 — CSS shapes. Обе технологии выглядят очень интересно, так что я решила попробовать их в действии, заодно выяснив как будет выглядеть страница в браузерах, где они не поддерживаются.","image":"http://img-fotki.yandex.ru/get/4805/5091629.a1/0_855c2_8fe321a9_M.jpg","customCSS":null,"customJs":null,"tags":["blend-modes"],"layout":null,"links":[{"desc":null,"name":"Compositing and Blending Level 1","url":"http://dev.w3.org/fxtf/compositing-1"},{"desc":null,"name":"background-blend-mode","url":"http://caniuse.com/#feat=css-backgroundblendmode"},{"desc":null,"name":"mix-blend-mode","url":"http://caniuse.com/#feat=css-mixblendmode"},{"desc":null,"name":"CSS Shapes Module Level 1","url":"http://dev.w3.org/csswg/css-shapes/"},{"desc":null,"name":"CSS Shapes","url":"http://caniuse.com/#feat=css-shapes"},{"desc":null,"name":"SVG Filter Effects","url":"http://www.w3.org/TR/SVG/filters.html"},{"desc":null,"name":"SVG filters","url":"http://caniuse.com/#feat=svg-filters"},{"desc":null,"name":"Background-blend-mode","url":"/background-blend-mode/"},{"desc":null,"name":"CSS и SVG маски","url":"/css-and-svg-masks"},{"desc":null,"name":"Грабли на чистом SVG","url":"/svg-in-ie8"}]}}},"pageContext":{"slug":"blend-modes-fallback","date":"07/10/2014","url":"/blend-modes-fallback","type":"post","includeContent":"","isArchived":true,"previous":{"frontmatter":{"title":"Грабли на чистом SVG"},"fields":{"url":"/svg-in-ie8","type":"post","isArchived":true}},"next":{"frontmatter":{"title":"Трюк на CSS для поддержки SVG в старых браузерах"},"fields":{"url":"/svg-fallback-in-ie9-and-androids2x","type":"post","isArchived":true}}}}}