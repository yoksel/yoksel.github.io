---
title: SVG плюс Angular минус Firefox

tags: [svg, firefox]

image: https://img-fotki.yandex.ru/get/15538/5091629.a3/0_86805_56cc8e5e_orig
desc: SVG удивительная технология, не в последнюю очередь благодаря своим оригинальным подводным камням. Парочка свежих проблем была обнаружена при взаимодействии SVG с Angular, причем они возникали только в Firefox.

---

SVG удивительная технология, не в последнюю очередь благодаря своим оригинальным подводным камням. Если вы начали работать с SVG — скучно точно не будет.

Парочка свежих проблем была обнаружена при взаимодействии SVG с Angular, причем они возникали только в Firefox. Я решила описать проблемы и их решения здесь: себе на память, другим на пользу.<!--more-->

<h2>Проблема № 1.</h2>

Дано: SVG-иконки, подключаемые через <code>use</code> в нужные места страницы. Конструкция работает как часы во всех современных браузерах, но тут приходит Angular и меняет <a href="http://www.w3.org/TR/html-markup/base.html"><code>base</code></a>. Во всех браузерах всё работает, кроме Firefox: в нем иконки исчезают, но только в случае, если ссылка в <code>base</code> не совпадает с адресом текущей страницы.

Про это даже есть <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=652991">баг</a> от 2011 года, но проблема до сих пор существует.

Демо (смотреть в Firefox):

<iframe class="frame--border" src="../assets/demo/svg-in-firefox/svg-no-base.html" style="width: 100%; height: 370px">
</iframe>
<a href="../assets/demo/svg-in-firefox/svg-no-base.html">Ссылка на демо</a>

<i>Оба кружка находятся внутри одного SVG, по нажатию на кнопку он полностью копируется. Голубой кружок слева — просто фигура, чтобы видеть, что в SVG вообще что-то есть. Красный кружок справа — символ, вставленный через <code>use</code>. Символ объявлен выше внутри того же SVG.</i>

Решение: если добавить тегу SVG атрибут <code>xml:base</code> и в нем задать URL текущей страницы, иконки начинают работать вне зависимости от ссылки в <code>base</code>.

Проверьте в Firefox:

<iframe class="frame--border" src="../assets/demo/svg-in-firefox/svg-has-base.html" style="width: 100%; height: 370px"></iframe>

<a href="../assets/demo/svg-in-firefox/svg-has-base.html">Ссылка на демо</a>

<h2>Проблема № 2.</h2>

Иконки, отрисовываемые внутри <code>ng-repeat</code>, могут не отображаться на странице. Код корректный, он есть на странице, но в <code>use</code> ничего нет, хотя тот же код, вынесенный из <code>ng-repeat</code>, прекрасно работает.

Решение:

1. Взять содержимое атрибута <code>xlink:href</code> элемента <code>use</code>.
2. Очистить <code>xlink:href</code>.
3. Вставить в <code>xlink:href</code> старое значение.

После этого иконки начинают отображаться.

Способ странный, но он работает.

По правде сказать, оба решения выглядят не очень изящно, и всем было бы гораздо проще, если бы SVG в Firefox просто вел себя как в других браузерах, но вот нет.

Если вы знаете более красивые способы решить эти проблемы, расскажите мне о них, пожалуйста.





